<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/layout/css/custom-stockdetail-style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/cb31ad365a.js" crossorigin="anonymous"></script>

    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/indicators/indicators-all.js"></script>
    <script src="https://code.highcharts.com/stock/indicators/ema.js"></script>
</head>
<body class="body">
<div class="sidenav">
    <img src="/layout/srcs/logo.svg" alt="logo" class="logo"/>
    <a href="#" class="menu">HOME</a>
    <a href="#" class="menu">TOP 10</a>
    <a href="#" class="menu">관심 종목</a>
    <a href="#" class="menu">자산 관리</a>
    <div class="flex-container">
        <img src="/layout/srcs/icons/user-logo.svg" alt="icon" class="flex-component"/>
        <a id="userName" class="flex-component" href="javascript:void(0);" th:text="${#authentication.name}"
           onclick="logout()" th:if="${#authorization.expression('isAuthenticated()')}"></a>
        <a class="flex-component" href="/login" th:unless="${#authorization.expression('isAuthenticated()')}">
            Login
        </a>
    </div>
</div>

<div class="main-content">
    <div class="search-group">
        <i class="fa-solid fa-magnifying-glass fa-lg" style="color: #315784;"></i>
        <input type="text" class="search-control" placeholder="검색어를 입력하세요.">
    </div>

    <!-- 종목 상세 정보 표시 부분 -->
    <h5 class="title">&nbsp;</h5>
    <div class="section-group">
        <div class="left-section">
            <div class="section">
                <!-- 종목 상세 정보 표시 부분 -->
                <div class="stock-detail-header">
                    <!-- 왼쪽 영역: 종목명과 코드, 아이콘 -->
                    <div class="stock-header-left">
                        <!-- 아이콘에 기본적으로 비어있는 별 'far' 클래스를 추가 -->
                        <i class="far fa-star stock-icon" style="cursor: pointer;"></i>
                        <div class="stock-info">
                            <h1 id="stock-name" class="stock-name" th:text="${stockInfo.stockName}">종목명</h1> <!-- 종목명 -->
                            <span id="stock-code" class="stock-code" th:text="${stockInfo.stockCode}">종목코드</span> <!-- 종목코드 -->
                            <input type="hidden" id="stock-mrktCtg" th:value="${stockInfo.mrktCtg}">
                        </div>
                    </div>

                    <!-- 가운데 영역: 현재가와 등락률 -->
                    <div class="stock-header-center">
                        <div id="price" class="price">79,600</div> <!-- 현재가 -->
                        <div id="price-change" class="price-change">▲ 1,000 | +1.27%</div> <!-- 등락률 -->
                    </div>

                    <!-- 오른쪽 영역: 세부 정보 (2줄로 배치) -->
                    <div class="stock-header-right">
                        <div class="info-item">
                            <p>전일</p>
                            <p><span id="previous-price">78,600</span></p> <!-- 전일 종가 -->
                        </div>
                        <div class="info-item">
                            <p>고가</p>
                            <p><span id="high-price">80,500</span></p> <!-- 고가 -->
                        </div>
                        <div class="info-item">
                            <p>거래량</p>
                            <p><span id="volume">22,780,406</span></p> <!-- 거래량 -->
                        </div>
                        <div class="info-item">
                            <p>시가</p>
                            <p><span id="open-price">79,700</span></p> <!-- 시가 -->
                        </div>
                        <div class="info-item">
                            <p>저가</p>
                            <p><span id="low-price">79,000</span></p> <!-- 저가 -->
                        </div>
                        <div class="info-item">
                            <p>거래대금</p>
                            <p><span id="transaction-amount">1,818,617</span></p> <!-- 거래대금 -->
                        </div>
                    </div>
                </div>

                <div class="stock-chart-container">
                    <div class="chart-tabs">
                        <button class="active">1일</button>
                        <button>1개월</button>
                        <button>3개월</button>
                        <button>1년</button>
                        <button>3년</button>
                    </div>
                    <div class="chart-box">
                        <div id="stock-chart" style="height: 400px;"></div>
                    </div>
                </div>
            </div>

            <h5 class="title">투자 정보</h5>
            <div class="section">
                <table class="investment-info-table">
                    <tbody id="combined-investment-info">
                    <!-- 기존 종목 투자 정보 -->
                    <tr>
                        <th>상한가</th>
                        <td id="upper-limit-price">-</td>
                        <th>외국인 비율</th>
                        <td id="foreign-ownership">-</td>
                    </tr>
                    <tr>
                        <th>하한가</th>
                        <td id="lower-limit-price">-</td>
                        <th>시가총액</th>
                        <td id="market-cap">-</td>
                    </tr>
                    <tr>
                        <th>52주 최고</th>
                        <td id="year-high">-</td>
                        <th>EPS/PER</th>
                        <td id="eps-per">-</td>
                    </tr>
                    <tr>
                        <th>52주 최저</th>
                        <td id="year-low">-</td>
                        <th>BPS/PBR</th>
                        <td id="bps-pbr">-</td>
                    </tr>

                    <!-- 새로운 투자자 정보 추가 -->
                    <tr>
                        <th>개인 순매수량</th>
                        <td id="prsn-ntby-qty">-</td>
                        <th>개인 순매수 거래대금</th>
                        <td id="prsn-ntby-tr-pbmn">-</td>
                    </tr>
                    <tr>
                        <th>외국인 순매수량</th>
                        <td id="frgn-ntby-qty">-</td>
                        <th>외국인 순매수 거래대금</th>
                        <td id="frgn-ntby-tr-pbmn">-</td>
                    </tr>
                    <tr>
                        <th>기관 순매수량</th>
                        <td id="orgn-ntby-qty">-</td>
                        <th>기관 순매수 거래대금</th>
                        <td id="orgn-ntby-tr-pbmn">-</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="right-section right-section-sticky">
            <div class="section user-asset">
                <div class="flex-text-group">
                    <p>총 자산</p>
                    <p class="total-asset">10,962,194 원</p>
                </div>
                <div class="flex-text-group">
                    <p>가용 자산</p>
                    <p class="available-asset">2,264,568 원</p>
                </div>
            </div>

            <div class="section order-form">
                <h6>주문 입력</h6>
                <div class="btn-group">
                    <button id="buy-btn" class="active">매수</button>
                    <button id="sell-btn">매도</button>
                </div>
                <form>
                    <!-- 주문 구분 -->
                    <div class="radio-group">
                        <label>주문 구분</label>
                        <input type="radio" id="fixed-price" name="priceType" checked>
                        <label for="fixed-price">지정가</label>
                        <input type="radio" id="market-price" name="priceType">
                        <label for="market-price">시장가</label>
                    </div>

                    <!-- 보유 주식 개수 (매도시 표시할 부분) -->
                    <div class="form-group" id="stock-holding-info" style="display: none;">
                        <label for="stock-holding">보유 주식</label>
                        <input type="text" id="stock-holding" value="0주" readonly>
                    </div>

                    <!-- 주문 수량 -->
                    <div class="form-group">
                        <label for="quantity">주문 수량</label>
                        <input type="text" id="quantity" placeholder="주">
                    </div>

                    <!-- 매수/매도 가격 -->
                    <div class="form-group">
                        <label for="buy-price">매수 가격</label>
                        <input type="text" id="buy-price" placeholder="원">
                    </div>

                    <!-- 주문 총액 -->
                    <div class="form-group">
                        <label for="total">주문 총액</label>
                        <input type="text" id="total" placeholder="원">
                    </div>

                    <div class="submit-group">
                        <button type="button" class="reserve-action">예약</button>
                        <button type="submit" class="buy-action">매수하기</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:inline="javascript">
    function logout() {
        axios.get('/auth/logout')
            .then(() => {
                window.location.href = '/login';
            })
            .catch(error => {
                console.error('Logout failed:', error);
                // 오류 발생 시 사용자에게 알림
                alert('로그아웃 중 오류가 발생했습니다. 다시 시도해 주세요.');
            });
    }
    function getCookie(cookieName) {
        let name = cookieName + "=";
        let decodedCookie = decodeURIComponent(document.cookie); // 쿠키 값이 인코딩되어 있을 수 있으므로 디코딩
        let cookieArray = decodedCookie.split(';'); // 각 쿠키는 세미콜론으로 구분됨

        for (let i = 0; i < cookieArray.length; i++) {
            let cookie = cookieArray[i].trim(); // 공백 제거

            // 쿠키 이름으로 시작하는지 확인
            if (cookie.indexOf(name) === 0) {
                return cookie.substring(name.length, cookie.length); // 쿠키 값 반환
            }
        }
        return ""; // 해당 이름의 쿠키가 없으면 빈 문자열 반환
    }

    document.addEventListener('DOMContentLoaded', function () {
    const userId = '1';  // 현재 로그인한 사용자의 ID (예: 고정된 ID)
    const stockCode = document.getElementById('stock-code').textContent.trim();
    const starIcon = document.querySelector('.stock-icon');

    // 즐겨찾기 여부 확인
    function checkFavoriteStatus() {
        axios.get('/api/favorites/check', {
            params: {
                userId: userId,
                stockCode: stockCode
            }
        })
        .then(response => {
            const isFavorite = response.data;
            updateStarIcon(isFavorite);
        })
        .catch(error => {
            console.error('즐겨찾기 상태 확인 실패:', error);
        });
    }

    // 아이콘 상태 업데이트 함수
    function updateStarIcon(isFavorite) {
        if (isFavorite) {
            starIcon.classList.add('fas');  // 채워진 별
            starIcon.classList.remove('far');  // 비어 있는 별 제거
        } else {
            starIcon.classList.add('far');  // 비어 있는 별
            starIcon.classList.remove('fas');  // 채워진 별 제거
        }
    }

    // 즐겨찾기 추가/삭제
    starIcon.addEventListener('click', function () {
        const isCurrentlyFavorite = starIcon.classList.contains('fas');
        const apiUrl = isCurrentlyFavorite ? '/api/favorites/remove' : '/api/favorites/add';

        axios.post(apiUrl, null, {
            params: {
                userId: userId,
                stockCode: stockCode
            }
        })
        .then(response => {
            alert(response.data);  // 성공 메시지 출력
            updateStarIcon(!isCurrentlyFavorite);  // 상태 반전
        })
        .catch(error => {
            console.error(`즐겨찾기 업데이트 실패: ${error.response ? error.response.data : error.message}`);
            alert('즐겨찾기 상태를 업데이트하는데 실패했습니다.');
        });
    });

    // 페이지 로드 시 즐겨찾기 상태 확인
    checkFavoriteStatus();
});

    document.addEventListener('DOMContentLoaded', function () {
        const stockCode = document.getElementById("stock-code").textContent.trim();
        console.log(`Loaded Stock Code: ${stockCode}`);

        let isFetchingStockDetail = false;  // 주식 상세 정보 플래그
        let isFetchingInvestorData = false;  // 투자자 정보 플래그

        // 종목 정보를 불러오는 함수
        function fetchStockDetail(stockCode) {
            if (isFetchingStockDetail) return;
            isFetchingStockDetail = true;

            axios.get(`/stock/quotations/${stockCode}`)
                .then(response => {
                    console.log("Received Stock Data: ", response.data);
                    const stockData = response.data.output;
                    if (!stockData || Object.keys(stockData).length === 0) {
                        alert('시세 데이터를 가져오지 못했습니다.');
                        return;
                    }
                    updateStockDetail(stockData);
                })
                .catch(error => {
                    console.error('Failed to fetch stock detail:', error.response ? error.response.data : error.message);
                    alert('주식 정보를 가져오는데 실패했습니다.');
                })
                .finally(() => {
                    isFetchingStockDetail = false;
                });
        }

        // 투자자 정보를 불러오는 함수
        function fetchStockInvestors(stockCode) {
            if (isFetchingInvestorData) return;
            isFetchingInvestorData = true;

            axios.get(`/stock/investors/${stockCode}`)
                .then(response => {
                    console.log("Received Investor Data: ", response.data);
                    const investorData = response.data.output;
                    if (!investorData || investorData.length === 0) {
                        alert('투자자 정보를 가져오지 못했습니다.');
                        return;
                    }
                    updateInvestorDetail(investorData[0]);
                })
                .catch(error => {
                    console.error('Failed to fetch investor details:', error.response ? error.response.data : error.message);
                    alert('투자자 정보를 가져오는데 실패했습니다.');
                })
                .finally(() => {
                    isFetchingInvestorData = false;
                });
        }

        // 종목 상세 정보 업데이트 함수
        function updateStockDetail(stockData) {
            document.getElementById('price').textContent = formatNumber(stockData.stck_prpr || 0);
            document.getElementById('price-change').textContent = `${stockData.prdy_vrss_sign || ''} ${formatNumber(stockData.prdy_vrss || 0)} | ${stockData.prdy_ctrt || 0}%`;

            document.getElementById('previous-price').textContent = formatNumber(stockData.stck_oprc || 0);
            document.getElementById('high-price').textContent = formatNumber(stockData.stck_hgpr || 0);
            document.getElementById('low-price').textContent = formatNumber(stockData.stck_lwpr || 0);
            document.getElementById('volume').textContent = formatNumber(stockData.acml_vol || 0);
            document.getElementById('open-price').textContent = formatNumber(stockData.stck_oprc || 0);
            document.getElementById('transaction-amount').textContent = `${formatNumber(stockData.acml_tr_pbmn || 0)} 백만`;

            document.getElementById('upper-limit-price').textContent = formatNumber(stockData.stck_mxpr || 0);
            document.getElementById('lower-limit-price').textContent = formatNumber(stockData.stck_llam || 0);
            document.getElementById('year-high').textContent = formatNumber(stockData.w52_hgpr || 0);
            document.getElementById('year-low').textContent = formatNumber(stockData.w52_lwpr || 0);
            document.getElementById('foreign-ownership').textContent = `${stockData.hts_frgn_ehrt || 0}%`;
            document.getElementById('market-cap').textContent = `${formatNumber(stockData.stck_fcam || 0)} 억`;
            document.getElementById('eps-per').textContent = `${stockData.eps || '-'} / ${stockData.per || '-'}`;
            document.getElementById('bps-pbr').textContent = `${stockData.bps || '-'} / ${stockData.pbr || '-'}`;
        }

        // 투자자 정보 업데이트 함수
        function updateInvestorDetail(investorData) {
            document.getElementById('prsn-ntby-qty').textContent = formatNumber(investorData.prsn_ntby_qty || 0);
            document.getElementById('prsn-ntby-tr-pbmn').textContent = `${formatNumber(investorData.prsn_ntby_tr_pbmn || 0)} 백만`;
            document.getElementById('frgn-ntby-qty').textContent = formatNumber(investorData.frgn_ntby_qty || 0);
            document.getElementById('frgn-ntby-tr-pbmn').textContent = `${formatNumber(investorData.frgn_ntby_tr_pbmn || 0)} 백만`;
            document.getElementById('orgn-ntby-qty').textContent = formatNumber(investorData.orgn_ntby_qty || 0);
            document.getElementById('orgn-ntby-tr-pbmn').textContent = `${formatNumber(investorData.orgn_ntby_tr_pbmn || 0)} 백만`;
        }

        function formatNumber(number) {
            return parseInt(number).toLocaleString();
        }

        fetchStockDetail(stockCode);
        fetchStockInvestors(stockCode);
    });

    document.addEventListener('DOMContentLoaded', function () {
        const buyButton = document.getElementById('buy-btn');
        const sellButton = document.getElementById('sell-btn');
        const quantityInput = document.getElementById('quantity');
        const buyPriceInput = document.getElementById('buy-price');
        const totalInput = document.getElementById('total');
        const submitButton = document.querySelector('.buy-action');
        const radioGroup = document.querySelector('.radio-group');
        const stockHoldingInfo = document.getElementById('stock-holding-info');
        const marketPriceRadio = document.getElementById('market-price');
        const fixedPriceRadio = document.getElementById('fixed-price');

        let orderType = 'buy';  // 기본 매수 상태로 설정

        // 동적으로 현재가 값을 참조하도록 변경
        function getCurrentPrice() {
            return parseInt(document.getElementById('price').textContent.replace(/,/g, ''), 10) || 0;
        }

        // 초기 값 설정 (최초 로드 시)
        let currentPrice = getCurrentPrice();

        // 매수/매도 폼 상태 전환 함수
        function toggleOrderForm(type) {
            orderType = type;

            if (type === 'buy') {
                buyButton.classList.add('active');
                sellButton.classList.remove('active');
                radioGroup.style.display = 'block';
                stockHoldingInfo.style.display = 'none';
                submitButton.textContent = '매수하기';
                updateFormLabels('매수 가격');
                resetOrderForm();
            } else {
                buyButton.classList.remove('active');
                sellButton.classList.add('active');
                radioGroup.style.display = 'none';
                stockHoldingInfo.style.display = 'block';
                submitButton.textContent = '매도하기';
                updateFormLabels('매도 가격');
                // 매도 시 가격을 최신 현재가로 설정
                buyPriceInput.value = getCurrentPrice().toLocaleString();
                calculateTotal();
            }
        }

        // 폼의 라벨 업데이트 함수
        function updateFormLabels(priceLabel) {
            document.querySelector('label[for="buy-price"]').textContent = priceLabel;
        }

        // 매수/매도 버튼 클릭 시 상태 전환
        buyButton.addEventListener('click', () => toggleOrderForm('buy'));
        sellButton.addEventListener('click', () => {
            toggleOrderForm('sell');
            // 매도 버튼 클릭 시 보유 주식 개수 요청
            fetchStockHolding();
        });

        function fetchStockHolding() {
            const userId = '1';  // 현재 사용자 ID (예: 고정된 ID)
            const stockCode = document.getElementById('stock-code').textContent.trim();

            axios.get(`/stock/order/holding/${userId}/${stockCode}`)
                .then(response => {
                    const holdingQuantity = response.data;
                    document.getElementById('stock-holding').value = `${holdingQuantity}주`;  // 보유 수량 표시
                })
                .catch(error => {
                    console.error(`보유 주식 수량 조회 실패: ${error.response ? error.response.data : error.message}`);
                    alert('보유 주식 개수를 가져오는데 실패했습니다.');
                });
        }

        // 시장가 라디오 버튼 선택 시 현재가로 가격 설정
        marketPriceRadio.addEventListener('change', function () {
            if (marketPriceRadio.checked) {
                buyPriceInput.value = getCurrentPrice().toLocaleString();
                buyPriceInput.setAttribute('readonly', true);
            }
            calculateTotal();
        });

        // 지정가 라디오 버튼 선택 시 가격 입력 가능
        fixedPriceRadio.addEventListener('change', function () {
            if (fixedPriceRadio.checked) {
                buyPriceInput.removeAttribute('readonly');
                buyPriceInput.value = '';
            }
            calculateTotal();
        });

        // 가격 또는 수량 입력 시 주문 총액 계산
        quantityInput.addEventListener('input', calculateTotal);
        buyPriceInput.addEventListener('input', calculateTotal);

        // 주문 총액 계산 함수
        function calculateTotal() {
            const quantity = parseInt(quantityInput.value.replace(/,/g, ''), 10) || 0;
            const price = parseInt(buyPriceInput.value.replace(/,/g, ''), 10) || 0;
            if (quantity && price) {
                totalInput.value = (quantity * price).toLocaleString();
            } else {
                totalInput.value = '';
            }
        }

        // 폼 초기화 함수
        function resetOrderForm() {
            quantityInput.value = '';
            buyPriceInput.value = '';
            totalInput.value = '';
        }

        // 주문 처리 (매수 또는 매도)
        submitButton.addEventListener('click', function (event) {
            event.preventDefault();  // 기본 제출 방지

            // 주문 정보를 수집
            const userId = '1';  // 사용자 ID 가져오기 (현재는 1로 고정)
            const stockCode = document.getElementById('stock-code').textContent.trim();  // 종목 코드 가져오기
            const stockName = document.getElementById('stock-name').textContent.trim();  // 종목명 가져오기
            const quantity = parseInt(quantityInput.value.replace(/,/g, ''), 10) || 0;  // 수량
            const price = parseInt(buyPriceInput.value.replace(/,/g, ''), 10) || 0;  // 가격
            const mrtgType = document.getElementById('stock-mrktCtg').value;  // 시장 구분

            // 필수 값 검증
            if (!userId || !stockCode || !stockName || !quantity || !price) {
                alert('주문 정보를 올바르게 입력해 주세요.');
                return;
            }

            // 주문 DTO 생성
            const requestData = {
                userId: userId,
                stockCode: stockCode,
                stockName: stockName,
                quantity: quantity,
                price: price,
                mrtgType: mrtgType
            };

            console.log("Sending request with data:", requestData);  // 요청 데이터 확인

            // API URL 설정
            const apiUrl = orderType === 'buy' ? '/stock/order/buy' : '/stock/order/sell';

            // 주문 API 호출
            axios.post(apiUrl, requestData)
                .then(response => {
                    alert(response.data);  // 성공 메시지 출력
                    resetOrderForm();  // 폼 초기화
                })
                .catch(error => {
                    console.error(`주문 실패: ${error.response ? error.response.data : error.message}`);
                    alert('주문 처리에 실패했습니다. 다시 시도해 주세요.');
                });
        });

        // 초기 상태 설정
        toggleOrderForm('buy');  // 기본은 매수 상태로 설정
});

//차트부분
/*    document.addEventListener('DOMContentLoaded', function () {
    let stockChart;
    // 이미 선언된 stockCode 사용
    const stockCode = document.getElementById("stock-code").textContent.trim();
    console.log(`Loaded Stock Code: ${stockCode}`);

    // 현재 날짜를 YYYYMMDD 형식으로 반환
    function getCurrentDate() {
        const now = new Date();
        const year = now.getFullYear();
        const month = ('0' + (now.getMonth() + 1)).slice(-2);
        const day = ('0' + now.getDate()).slice(-2);
        return `${year}${month}${day}`;
    }

    // 한국투자증권 API에서 가져온 데이터를 변환
    function transformData(apiData) {
        if (!apiData || !apiData.output2) {
            console.error('데이터가 없습니다. 또는 output2가 존재하지 않습니다.');
            return [];
        }

        console.log("API 데이터 확인:", apiData.output2); // 데이터 필드 확인용 로그 추가

        return apiData.output2
            .filter(item => item.stck_oprc && item.stck_prpr)  // 필요한 필드가 모두 있는지 확인
            .map(item => [
                // 아래의 필드를 실제 데이터에 맞게 조정
                new Date(item.stck_oprc_date.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')).getTime(), // 올바른 날짜 필드로 변경
                parseFloat(item.stck_oprc),  // 시가
                parseFloat(item.stck_hgpr),  // 고가
                parseFloat(item.stck_lwpr),  // 저가
                parseFloat(item.stck_prpr),  // 종가
                parseInt(item.acml_vol, 10)  // 거래량
            ]);
    }

    // 차트를 생성하는 함수
    function createChart(stockData) {
        // 거래량 데이터만 분리
        const volumeData = stockData.map(item => [item[0], item[5]]);

        stockChart = Highcharts.stockChart('stock-chart', {
            chart: {
                backgroundColor: '#FFFFFF',
                borderColor: '#3947b2',
                borderWidth: 1,
                style: {
                    fontFamily: 'Pretendard, Arial, sans-serif',
                }
            },
            accessibility: {
                enabled: false  // 접근성 관련 경고 제거
            },
            rangeSelector: {
                selected: 1,
                inputEnabled: false,
                buttonTheme: {
                    fill: 'none',
                    stroke: '#3947b2',
                    'stroke-width': 1,
                    style: {
                        color: '#3947b2',
                        fontWeight: 'bold'
                    },
                    states: {
                        hover: {
                            fill: '#3947b2',
                            style: {
                                color: 'white'
                            },
                        },
                        select: {
                            fill: '#3947b2',
                            style: {
                                color: 'white'
                            },
                        },
                    },
                },
                labelStyle: {
                    color: '#3947b2',
                    fontWeight: 'bold'
                },
            },
            title: {
                text: '주식 차트',
                style: {
                    color: '#3947b2',
                    fontWeight: 'bold'
                }
            },
            yAxis: [
                {
                    labels: {
                        align: 'right',
                        x: -3,
                        style: {
                            color: '#3947b2',
                        }
                    },
                    title: {
                        text: '주가',
                        style: {
                            color: '#3947b2',
                        }
                    },
                    height: '70%',
                    lineWidth: 2,
                    resize: {
                        enabled: true
                    }
                },
                {
                    labels: {
                        align: 'right',
                        x: -3,
                        style: {
                            color: '#3947b2',
                        }
                    },
                    title: {
                        text: '거래량',
                        style: {
                            color: '#3947b2',
                        }
                    },
                    top: '75%',
                    height: '25%',
                    offset: 0,
                    lineWidth: 2,
                },
            ],
            tooltip: {
                split: true,
                valueDecimals: 2,
            },
            series: [
                {
                    type: 'candlestick',
                    name: '주가',
                    id: '주가',  // ID를 '주가'로 설정하여 linkedTo와 연결 가능하게 함
                    data: stockData.map(item => [item[0], item[1], item[2], item[3], item[4]]),
                    yAxis: 0,  // 주가는 첫 번째 yAxis 사용
                    color: '#d32f2f',  // 하락 색상
                    upColor: '#3947b2',  // 상승 색상
                },
                {
                    type: 'column',
                    name: '거래량',
                    data: volumeData,
                    yAxis: 1,  // 거래량은 두 번째 yAxis 사용
                    color: '#76c7c0',  // 거래량 색상
                },
                {
                    type: 'sma',
                    name: '50일 이동평균',
                    linkedTo: '주가',
                    yAxis: 0,  // 주가의 이동평균선도 첫 번째 yAxis 사용
                    params: { period: 50 },
                }
            ],
        });
    }

    // 한국투자증권 API를 호출하여 데이터를 가져오고 차트를 생성
    function fetchDataAndCreateChart(stockCode, startDate, endDate, periodCode) {
        axios.get(`/stock/quotations/${stockCode}/period`, {
            params: {
                startDate: startDate,
                endDate: endDate,
                periodCode: periodCode,
                orgAdjPrc: '0'
            }
        })
        .then(response => {
            const transformedData = transformData(response.data);
            createChart(transformedData);
        })
        .catch(error => {
            console.error('API 호출 오류:', error.response ? error.response.data : error.message);
        });
    }
    // 초기 데이터 로드
    const startDate = getCurrentDate();  // 시작 날짜 (임의 설정)
    const endDate = getCurrentDate();  // 현재 날짜 가져오기
    const periodCode = '1';
    fetchDataAndCreateChart(stockCode, startDate, endDate, periodCode); // 초기 데이터 로드

    document.querySelectorAll('.chart-tabs button').forEach((button) => {
        button.addEventListener('click', function () {
            document.querySelectorAll('.chart-tabs button').forEach((btn) => btn.classList.remove('active'));
            button.classList.add('active');

            const period = button.innerText;
            let periodCode = '1';

            switch (period) {
                case '1일':
                    periodCode = '1';
                    break;
                case '1개월':
                    periodCode = '2';
                    break;
                case '3개월':
                    periodCode = '3';
                    break;
                case '1년':
                    periodCode = '4';
                    break;
                case '3년':
                    periodCode = '5';
                    break;
                default:
                    periodCode = '1';
            }

            fetchDataAndCreateChart(stockCode, startDate, endDate, periodCode);
        });
    });
});*/
</script>